---
title: 在Windows上一键批量安装根证书的方法
date: 2025-08-25 19:20:50
---

# 前提

- 所有的证书都放在同一个文件夹
- 证书格式为`.crt`

# 创建脚本文件

创建为 `Install-RootCerts.ps1`（确保文件扩展名是 `.ps1`）。

1. **编辑脚本内容**：
   - 右键点击该文件，选择“**用记事本编辑**”或使用任何文本编辑器。
   - 将以下代码复制粘贴进去：

```powershell
# 将该目录替换为你的证书目录
$certPath = "C:\ca-certificates"

# 获取所有 .crt 文件
$crtFiles = Get-ChildItem -Path $certPath -Filter *.crt

# 检查是否找到了证书文件
if ($crtFiles.Count -eq 0) {
    Write-Host "在目录 $certPath 中未找到任何 .crt 文件。" -ForegroundColor Yellow
    exit
}

# 遍历每个证书文件并进行安装
foreach ($crtFile in $crtFiles) {
    $certFullPath = $crtFile.FullName

    # 导入证书到本地机器的“受信任的根证书颁发机构”存储
    try {
        # 使用 .NET 类来导入证书
        $cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2
        $cert.Import($certFullPath)

        # 将证书添加到指定存储
        $store = New-Object System.Security.Cryptography.X509Certificates.X509Store("Root", "LocalMachine")
        $store.Open("ReadWrite")

        # 检查证书是否已存在，避免重复添加
        $existingCerts = $store.Certificates.Find("FindByThumbprint", $cert.Thumbprint, $false)
        if ($existingCerts.Count -eq 0) {
            $store.Add($cert)
            Write-Host "[成功] 已安装根证书: $($crtFile.Name)" -ForegroundColor Green
        } else {
            Write-Host "[信息] 证书已存在，跳过: $($crtFile.Name)" -ForegroundColor Cyan
        }

        $store.Close()
    }
    catch {
        Write-Host "[错误] 安装证书失败: $($crtFile.Name)。错误信息: $($_.Exception.Message)" -ForegroundColor Red
    }
}

Write-Host "`n批量安装操作完成！" -ForegroundColor White
Pause # 按任意键继续...
```

